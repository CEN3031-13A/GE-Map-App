'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}(function(window){Polymer({is:'px-breadcrumbs',behaviors:[PxAppBehavior.AssetGraph,PxAppBehavior.AssetSelectable,Polymer.IronResizableBehavior],properties:{_mainPathItems:{type:Array,value:function value(){return[]},readOnly:true},_clickPathItem:{type:Object,value:function value(){return{}}},_clickedItemChildren:{type:Array,value:function value(){return[]}},_selectedItem:{type:Object},_ulWidth:{type:Number,value:0},_selectedItemPath:{type:Array,value:function value(){return[]},readOnly:true},clickOnlyMode:{type:Boolean,value:false,observer:'_getBreadcrumbsObj'},searchMode:{type:Boolean,value:false},_hideNoResultLi:{type:Boolean,value:true},_breadcrumbsObj:{type:Object}},listeners:{'iron-resize':'_onResize','px-app-asset-selected':'_onSelect','px-dropdown-selection-changed':'_dropdownTap','px-app-asset-graph-created':'_getBreadcrumbsObj'},observers:['_getDisplayMode(_ulWidth, _selectedItemPath, _breadcrumbsObj)'],detached:function detached(){if(this.isDebouncerActive('windowResize'))this.cancelDebouncer('windowResize')},_onResize:function _onResize(){var _this=this;this.debounce('windowResize',function(){window.requestAnimationFrame(function(){var breadcrumbsContainer=Polymer.dom(_this.root).querySelector('.container'),breadcrumbsUlContainer=Polymer.dom(breadcrumbsContainer).querySelector('ul'),bcUlContainerRect=breadcrumbsUlContainer.getBoundingClientRect();_this.set('_ulWidth',bcUlContainerRect.width)})},50)},_getBreadcrumbsObj:function _getBreadcrumbsObj(){var itemPath=this._selectedItemPath||[],graph=this._assetGraph,clickOnlyMode=this.clickOnlyMode;if(!itemPath.length||!graph)return;this.set('_breadcrumbsObj',new window.pxBreadcrumbs.Breadcrumbs(this,graph,clickOnlyMode,itemPath));this.updateStyles()},_getDisplayMode:function _getDisplayMode(){var ulWidth=this._ulWidth,itemPath=this._selectedItemPath||[],breadcrumbsObj=this._breadcrumbsObj;if(!ulWidth||!itemPath||!breadcrumbsObj)return;if(ulWidth>breadcrumbsObj.sizeOfFullBreadcrumbs){this._set_mainPathItems(itemPath);return}if(ulWidth>breadcrumbsObj.sizeOfAllShortenedItemsExcludingLastItem+breadcrumbsObj.sizeOfFullLastItem){var strArrayShortenedWithFullLastItem=breadcrumbsObj.allShortenedItemsExcludingLast.concat(breadcrumbsObj.lastItemFull);this._set_mainPathItems(strArrayShortenedWithFullLastItem);return}if(ulWidth>breadcrumbsObj.sizeOfAllShortenedItems){var strArrayShortened=breadcrumbsObj.shortenedItems;this._set_mainPathItems(strArrayShortened);return}this._set_mainPathItems(this._createArrayWithOverflow(itemPath,ulWidth,breadcrumbsObj))},_createArrayWithOverflow:function _createArrayWithOverflow(strArray,_ulWidth,breadcrumbsObj){var pointer=0,currentAccumSize=breadcrumbsObj.sizeOfAllShortenedItemsExcludingLastItem,sizeOfFullLastItem=breadcrumbsObj.sizeOfFullLastItem,sizeOfEllipsis=36,noRoomForFullLastItem=false,lastItem={},overflowObj={'label':'...','hasChildren':true},slicedStrArray=[];while(_ulWidth<sizeOfEllipsis+currentAccumSize+sizeOfFullLastItem){if(pointer===strArray.length-1){noRoomForFullLastItem=true;break}var removedSize=breadcrumbsObj._sizeOfIndividualShortItem(strArray[pointer]);currentAccumSize-=removedSize;pointer++}overflowObj.children=strArray.slice(0,pointer);overflowObj.children.forEach(function(child){child.highlighted=false});lastItem=noRoomForFullLastItem?breadcrumbsObj.lastItemShort:breadcrumbsObj.lastItemFull;slicedStrArray=[overflowObj].concat(breadcrumbsObj.shortenedItems.slice(pointer,strArray.length-1)).concat(lastItem);return slicedStrArray},_isNotFirstItemInData:function _isNotFirstItemInData(index){return index!==0},_onSelect:function _onSelect(evt){this._set_selectedItemPath(evt.detail.path);this._getBreadcrumbsObj()},_doesItemHaveSiblings:function _doesItemHaveSiblings(itemInPath){var graph=this._assetGraph,source=itemInPath.source?itemInPath.source:itemInPath,isItemOverflow=itemInPath.label==='...'?true:false;return isItemOverflow?true:graph.hasSiblings(source)},_dropdownTap:function _dropdownTap(evt){var newSelectItem={};if(evt.target&&evt.target.items){evt.target.items.forEach(function(item){if(item.id===evt.target.selected){newSelectItem=item}})}this._changePathFromClick(newSelectItem)},_changePathFromClick:function _changePathFromClick(item){this.select(item);this.fire('px-breadcrumbs-item-changed',item)},_onPathTap:function _onPathTap(evt){var dataItem=evt.model.item.source?evt.model.item.source:evt.model.item;var isClickedItemOverflow=dataItem.label==='...'?true:false;if(this.clickOnlyMode&&!isClickedItemOverflow){this._changePathFromClick(dataItem);return}if(this._doesItemHaveSiblings(dataItem)||isClickedItemOverflow){var graph=this._assetGraph,siblings=!isClickedItemOverflow?graph.getSiblings(dataItem):dataItem.children;var siblingsCopy=siblings.map(function(sibling){return Object.assign({},sibling,{'key':sibling.id,'val':sibling.label})});this.set('_clickedItemChildren',siblingsCopy);this.set('_clickPathItem',dataItem)}else{this.set('_clickedItemChildren',[]);this._changePathFromClick(dataItem)}},_isLabel:function _isLabel(item,clickOnlyMode){return clickOnlyMode&&item.label!=='...'||!clickOnlyMode&&!this._doesItemHaveSiblings(item)},_isDropdown:function _isDropdown(item,clickOnlyMode){return!clickOnlyMode&&item.label!=='...'&&this._doesItemHaveSiblings(item)},_isOverflow:function _isOverflow(item){return item.label==='...'},_getSeparatorSize:function _getSeparatorSize(clickOnlyMode){return this.clickOnlyMode?'small':'large'}});var Breadcrumbs=function(){function Breadcrumbs(breadcrumbEl,graph,clickOnlyMode){var breadcrumbs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];_classCallCheck(this,Breadcrumbs);this.breadcrumbEl=breadcrumbEl;this.graph=graph;this.clickOnlyMode=clickOnlyMode;this.breadcrumbs=breadcrumbs;this.map=new WeakMap;this.ctx=this._createCanvas(breadcrumbEl);this._preShortenItems(this.breadcrumbs);return this}_createClass(Breadcrumbs,[{key:'_addToWeakMap',value:function _addToWeakMap(item){var cachedItem=this.map.get(item)||null;if(!cachedItem){this.map.set(item,item)}}},{key:'_preShortenItems',value:function _preShortenItems(items){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=items[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var item=_step.value;this._getShortenedText(item)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:'_getShortenedText',value:function _getShortenedText(item){var cachedItem=this.map.get(item)||{};if(!cachedItem.shortText&&item.label.length>13){cachedItem.shortText=item.label.substr(0,6)+'...'+item.label.substr(item.label.length-6)}else if(!cachedItem.shortText){cachedItem.shortText=item.label}this.map.set(item,cachedItem);return cachedItem.shortText}},{key:'_sizeOfIndividualFullItem',value:function _sizeOfIndividualFullItem(item){var cachedItem=this.map.get(item)||{};cachedItem.fullSize=cachedItem.fullSize||parseInt(this.ctx.measureText(item.label).width,10);this.map.set(item,cachedItem);return cachedItem.fullSize}},{key:'_sizeOfIndividualShortItem',value:function _sizeOfIndividualShortItem(item){var cachedItem=this.map.get(item)||{};cachedItem.shortSize=cachedItem.shortSize||parseInt(this.ctx.measureText(cachedItem.shortText).width,10);this.map.set(item,cachedItem);return cachedItem.shortSize}},{key:'_calculateSizeOfBreadcrumbs',value:function _calculateSizeOfBreadcrumbs(strArray){var useFullSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(strArray){var accum=0,i=0,len=strArray.length,sizeOfItem=void 0;for(i=0;i<len;i++,sizeOfItem=null){if(useFullSize){sizeOfItem=this._sizeOfIndividualFullItem(strArray[i])}else{sizeOfItem=this._sizeOfIndividualShortItem(strArray[i])}var source=strArray[i].source?strArray[i].source:strArray[i];accum+=sizeOfItem;if(strArray[i].label!=='...'&&this.graph.hasSiblings(source)&&!this.clickOnlyMode){accum+=21}accum+=20;if(i!==len-1){accum+=this.clickOnlyMode?30:15}}return accum+10}}},{key:'_createCanvas',value:function _createCanvas(breadcrumbEl){var style=window.getComputedStyle(breadcrumbEl,null),fontSize=style.getPropertyValue('font-size'),fontFamily=style.getPropertyValue('font-family');var canvas=document.createElement('canvas');canvas.height=20;canvas.width=9999;var ctx=canvas.getContext('2d');ctx.font=fontSize+' '+fontFamily;return ctx}},{key:'sizeOfFullBreadcrumbs',get:function get(){this.__sizeOfFullBreadcrumbs=this.__sizeOfFullBreadcrumbs||this._calculateSizeOfBreadcrumbs(this.breadcrumbs);return this.__sizeOfFullBreadcrumbs}},{key:'sizeOfAllShortenedItemsExcludingLastItem',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(0,this.breadcrumbs.length-1),false)}},{key:'sizeOfFullLastItem',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1))}},{key:'sizeOfShortLastItem',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1),false)}},{key:'lastItemFull',get:function get(){return this.breadcrumbs.slice(-1)[0]}},{key:'lastItemShort',get:function get(){return this.shortenedItems.slice(-1)[0]}},{key:'shortenedItems',get:function get(){var _this2=this;this.__shortenedItems=this.__shortenedItems||this.breadcrumbs.map(function(item){var wrapper={};wrapper.source=item;wrapper.isTruncated=true;wrapper.label=_this2._getShortenedText(item);wrapper.children=item.children;wrapper.selectedItem=item.selectedItem;wrapper.hasChildren=item.hasChildren;return wrapper});return this.__shortenedItems}},{key:'sizeOfEllipsis',get:function get(){return 36}},{key:'sizeOfAllShortenedItems',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs,false)}},{key:'allShortenedItemsExcludingLast',get:function get(){return this.shortenedItems.slice(0,this.shortenedItems.length-1)}}]);return Breadcrumbs}();window.pxBreadcrumbs={};window.pxBreadcrumbs.Breadcrumbs=Breadcrumbs})(window);
//# sourceMappingURL=px-breadcrumbs.js.map
